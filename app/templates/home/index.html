<!-- app/templates/home/index.html -->

{% import "bootstrap/wtf.html" as wtf %}
{% extends "base.html" %}
{% block head %}

<meta charset="utf-8"/>

<!-- Load libraries -->
<script src="//d3js.org/d3.v4.min.js"></script>  
<script type="{{ url_for('static', filename='js/exampleUtil.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-csv.js') }}"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
<script src="{{ url_for('static', filename='js/functions.js') }}"></script>
<script src="https://unpkg.com/d3-simple-slider@0.2.1/build/d3-simple-slider.js"></script>
<script src="{{ url_for('static', filename='js/lineGraph.js') }}"></script>
<script src="http://d3js.org/queue.v1.min.js" type="text/javascript"></script>
<script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="{{ url_for('static', filename='js/test.js') }}"></script>

<!-- Load python data -->
<script type="text/javascript"> 
  var data = {{ causalData|tojson }}; 

  var newData = {"nodes":[], "edges":[]}; 
  var op_dict = {{ op_dict|tojson }};
  var cl_dict = {{ cl_dict|tojson }};
</script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
{% endblock %}

<!-- Title -->
{% block title %}Testing{% endblock %}

<!-- Body -->
<!-- Introductory talk -->
{% block body %}
<center>
<div class="container col-8">
  <h1>Creating a causal mapping of depression</h1>
  <p class="text-justify">Depression is a major contributor to the overall global burden of disease (WHO). Globally, more than 300 million people suffer from depression. Psychological and pharmacological treatments are effective treatments but only for half of treated patients. Further, relapse rates in depression after remission are unacceptably high. Despite a large body of research literature, effect sizes for treatment efficacy have not increased over at least four decades. Evidence for leading theories that explain the onset and maintenance of depression is fragmented (Siegle et al., 2018). Whereas, depression is seen as a disorder that is caused by interplay of mental-, biological, stress related- and societal factors that can change over time characterized by large individual differences. One of the main research challenges is to understand the causal interplay between these factors. An integrated systemic approach is the step needed to generate insights needed for the development of innovative more effective treatments. 
  For this research we aim to create and validate a causal loop model of major depression using complexity modelling, in order to identify new targets for treatment. To create this causal loop model, we conducted an extensive meta-analysis that examined the evidence for leading models for depression  (> 140.000 articles, Bockting et al., in prep.) and now we will interview leading experts.
  </p>
</div>
</center>

<div class="wrapper">
  <!-- Sidebar Holder -->
  <nav id="sidebar">
      <div class="sidebar-header">
          <h3>Extra Options</h3>
      </div>

      <ul class="list-unstyled components">
          <li class="active">
              <a href="#language" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">visualization Language</a>
                <ul class="collapse list-unstyled" id="language">
                  <center>
                  <li>
                    Select a locale:
                  </li>
                  <li>
                    <select id="locale" onchange="draw();">
                    <option value="en">en</option>
                    <option value="de">de</option>
                    <option value="es">es</option>
                    <option value="it">it</option>
                    <option value="nl">nl</option>
                    <option value="pt-br">pt</option>
                    <option value="ru">ru</option>
                  </select>
                  </li>
                  </center>
                </ul>
          </li>
          <li>
              <a href="#exportingData" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Export Data</a>
              <ul class="collapse list-unstyled" id="exportingData">
                <center>
                <li>
                  Pick format: 
                </li>
                <li>
                  <select id="export">
                  <option value="json">.json</option>
                  <option value="csv">.csv</option>
                  <option value="pkl">Adjacency Matrix</option>
                </select>
                </li>
                <li>
                  <button onclick="export_data();">Export Current Data</button>
                </li>
                </center>
              </ul>
          </li>
          <li>
            <a href="#importData" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Import Data</a>
            <ul class="collapse list-unstyled" id="importData">
              <li>
                <center>
                <li>
                  IMPORT CSV: 
                </li>
                <li>First nodes, then edges</li>
                <li>
                  <input type="file" class="inputfile" id="selectFiles1" value="Import nodes" accept=".csv"/>
                </li>
                <li>
                  <input type="file" class="inputfile" id="selectFiles2" value="Import edges" accept=".csv"/>
                </li>
                <li>
                  <button id="import">Import</button>
                </li>
                </center>
              </li>
              <li>
                <center>
                <li>
                  IMPORT JSON: 
                </li>
                <li>
                  <input type="file" class="inputfile" id="selectFilesJSON" value="Import JSON" accept=".json"/>
                </li>
                <li>
                  <button id="importJSON">Import</button>
                </li>
                </center>
              </li>
            </ul>
          </li>
          {% if current_user.is_authenticated %}
          <li>
            <a href="#saveProgress" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Save progress</a>
            <ul class="collapse list-unstyled" id="saveProgress">
              <li>
                <button onclick="saveData()">Save Changes to Database</button> 
              </li>
            </ul>
          </li>
          {% endif %}
      </ul>
  </nav>

  <!-- Page Content Holder -->
  <div id="content">
    <center>
      <button type="button" id="sidebarCollapse" class="navbar-btn">
          <span></span>
          <span></span>
          <span></span>
      </button>
    
      <p>Toggle for more options</p>
    </center>
    <center>
        <div id="node-popUp">
          <span id="node-operation">node</span> <br>
          <table style="margin:auto; width: 75%;">
            <tr>
              <td class="tableLeft">label</td><td><input class="selections tableRight" id="node-label" value="new value" /></td>
            </tr>
            <tr>
              <td class="tableLeft">Notes on factor</td><td><input class="selections tableRight" id="node-notes_factor" /></td>
            </tr>
            <tr>
              <td class="tableLeft">General notes</td><td><input class="selections tableRight" id="node-notes" /></td>
            </tr>
            <tr>
              <td class="tableLeft">Supporting literature (seperate by / )</td><td><input class="selections tableRight" id="node-sup_lit" /></td>
            </tr>
            <tr>
              <td class="tableLeft">Node threshold (int[-10, 10])</td><td><input class="selections tableRight" id="node-threshold" /></td>
            </tr>
            <tr>
              <td class="tableLeft">At what stage is this important?</td><td><select class="selections tableRight" id="node-temp_imp_id">
              {% for i, temp_imp in temp_imps %}
                  <option value={{ i|string }}>{{ temp_imp }}</option>
              {% endfor %}
              </select></td>
            </tr>
            <tr>
              <td class="tableLeft">How fast are changes concerning this factor?</td><td><select class="selections tableRight" id="node-temp_aspect_id">
                {% for i, temp_aspect in temp_aspects %}
                  <option value={{ i|string }}>{{ temp_aspect }}</option>
                {% endfor %}
              </select></td>
            </tr>
          </table>
          <input type="button" value="save" id="node-saveButton" />
          <input type="button" value="cancel" id="node-cancelButton" />
        </div>

        <div id="edge-popUp">
          <span id="edge-operation">edge</span> <br>
          <table style="margin:auto; width:75%;">
            <tr>
              <td class="tableLeft">Label</td><td><input class="selections tableRight" id="edge-label" /></td>
            </tr>
            <tr>
              <td class="tableLeft">Type</td><td><select class="selections tableRight" id="edge-operator_id">
              {% for i, operator in operators %}
                  <option value={{ i|string }}>{{ operator }}</option>
              {% endfor %}
              </select></td>
            </tr>
            <tr>
              <td class="tableLeft">Relation Weight (int[-10, 10])</td><td><input class="selections tableRight" id="edge-value" value="''" /></td>
            </tr>
            <tr>
              <td class="tableLeft">At what stage is this important?</td><td><select class="selections tableRight" id="edge-temp_imp_id">
              {% for i, temp_imp in temp_imps1 %}
                  <option value={{ i|string }}>{{ temp_imp }}</option>
              {% endfor %}
              </select></td>
            </tr>
            <tr>
              <td class="tableLeft">How fast is this relation?</td><td><select class="selections tableRight" id="edge-temp_aspect_id">
                {% for i, temp_aspect in temp_aspects1 %}
                  <option value={{ i|string }}>{{ temp_aspect }}</option>
                {% endfor %}
              </select></td>
            </tr>
            <tr>
              <td class="tableLeft">Notes on relation</td><td><input class="selections tableRight" id="edge-notes_relation" /></td>
            </tr>
            <tr>
              <td class="tableLeft">Supporting literature (seperate by / )</td><td><input class="selections tableRight" id="edge-sup_lit" /></td>
            </tr>
          </table>
          <br>
          <input type="button" value="save" id="edge-saveButton" />
          <input type="button" value="cancel" id="edge-cancelButton" />
        </div>

        <div id="mynetwork"></div>
    </center>
  </div>
</div>

<script src="{{ url_for('static', filename='js/testing.js') }}"></script>
<script src="{{ url_for('static', filename='js/fut_exp_graph.js') }}"></script>

{% endblock %}